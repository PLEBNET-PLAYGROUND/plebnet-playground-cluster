#!/bin/bash

if hash docker 2>/dev/null; then

THUNDERHUB_ID=$(echo $(docker ps | awk '/thunderhub/'|awk ' {print $1}' | awk 'NR==1'))
export THUNDERHUB_ID
THUNDERHUB_IMAGE=$(echo $(docker images | awk '/thunderhub/'|awk ' {print $3}' | awk 'NR==1'))
export THUNDERHUB_IMAGE

RTL_ID=$(echo $(docker ps | awk '/rtl/'|awk ' {print $1}' | awk 'NR==1'))
export RTL_ID
RTL_IMAGE=$(echo $(docker images | awk '/rtl/'|awk ' {print $3}' | awk 'NR==1'))
export RTL_IMAGE

LND_ID=$(echo $(docker ps | awk '/lnd/'|awk ' {print $1}' | awk 'NR==1'))
export LND_ID
LND_IMAGE=$(echo $(docker images | awk '/lnd/'|awk ' {print $3}' | awk 'NR==1'))
export LND_IMAGE

DOCS_ID=$(echo $(docker ps | awk '/docs/'|awk ' {print $1}' | awk 'NR==1'))
export DOCS_ID
DOCS_IMAGE=$(echo $(docker images | awk '/docs/'|awk ' {print $3}' | awk 'NR==1'))
export DOCS_IMAGE

BITCOIND_ID=$(echo $(docker ps | awk '/bitcoind/'|awk ' {print $1}' | awk 'NR==1'))
export BITCOIND_ID
BITCOIND_IMAGE=$(echo $(docker images | awk '/bitcoind/'|awk ' {print $3}' | awk 'NR==1'))
export BITCOIND_IMAGE

TOR_ID=$(echo $(docker ps | awk '/tor/'|awk ' {print $1}' | awk 'NR==1'))
export TOR_ID
TOR_IMAGE=$(echo $(docker images | awk '/tor/'|awk ' {print $3}' | awk 'NR==1'))
export TOR_IMAGE

BTCD_ID=$(echo $(docker ps | awk '/btcd/'|awk ' {print $1}' | awk 'NR==1'))
export BTCD_ID
BTCD_IMAGE=$(echo $(docker images | awk '/btcd/'|awk ' {print $3}' | awk 'NR==1'))
export BTCD_IMAGE

for ((i=1;i<=$#;i++));
do

    if [[ ${!i} = *ids ]]; then
        ((i++))
        echo THUNDERHUB_ID:
        echo $THUNDERHUB_ID
        echo RTL_ID:
        echo $RTL_ID
        echo LND_ID:
        echo $LND_ID
        echo DOCS_ID:
        echo $DOCS_ID
        echo BITCOIND_ID:
        echo $BITCOIND_ID
        echo TOR_ID:
        echo $TOR_ID
        [ -z "$BTCD_ID" ] && echo "try 'make btcd'"|| echo BTCD_ID:
        [ -z "$BTCD_ID" ] && echo || echo $BTCD_ID
        exit

    elif [[ ${!i} = *images ]]; then
        ((i++))
        echo THUNDERHUB_IMAGE:
        echo $THUNDERHUB_IMAGE
        echo RTL_IMAGE:
        echo $RTL_IMAGE
        echo LND_IMAGE:
        echo $LND_IMAGE
        echo DOCS_IMAGE:
        echo $DOCS_IMAGE
        echo BITCOIND_IMAGES:
        echo $BITCOIND_IMAGE
        echo TOR_IMAGE:
        echo $TOR_IMAGE
        [ -z "$BTCD_IMAGE" ] && echo "try 'make btcd'"|| echo BTCD_IMAGE:
        [ -z "$BTCD_IMAGE" ] && echo || echo $BTCD_IMAGE
        exit

    elif [[ ${!i} = top ]]; then
        ((i++))
        docker top ${!i}
        exit

    elif [[ ${!i} = *start ]]; then
        ((i++))
        docker restart ${!i}
        exit

    elif [[ ${!i} = stop ]]; then
        ((i++))
        docker stop ${!i}
        exit

    elif [[ ${!i} = *cli ]]; then
        ((i++))
        docker exec -it $BITCOIND_ID sh -c  "/usr/local/bin/bitcoin-cli $2 $3 $4"
        [ -z "$BTCD_ID" ] && echo || docker exec -it $BTCD_ID sh -c  "/usr/local/bin/bitcoin-cli $2 $3 $4"
        exit

    elif [[ ${!i} = *d ]]; then
        ((i++))
        docker exec -it $BITCOIND_ID sh -c  "/usr/local/bin/bitcoind $2 $3 $4"
        [ -z "$BTCD_ID" ] && echo || docker exec -it $BTCD_ID sh -c  "/usr/local/bin/bitcoind $2 $3 $4"
        exit

    elif [[ ${!i} = *shell ]]; then
        ((i++))
        [ -z "$2" ] && echo "try 'play ids' then 'make shell <CONTAINER_ID>'" || docker exec -it $2 sh
        exit

    elif [[ ${!i} = *debug ]]; then
        ((i++))
        docker exec -it $BITCOIND_ID sh -c "tail -f /home/root/.bitcoin"

    elif [[ ${!i} == *help ]]; then
        ((i++))
        echo
        echo "play                     ids"
        echo "play                     top   <CONTAINER_ID>"
        echo "play                     shell <CONTAINER_ID>"
        echo "play                     start <CONTAINER_ID>"
        echo "play                     stop  <CONTAINER_ID>"
        echo
        echo "Examples:"
        echo
        echo "docker exec -it <CONTAINER_ID> sh    - enter container shell"
        echo
        echo "playground-bitcoind"
        echo
        echo "play -cli gettxoutsetinfo"
        echo "docker exec -it $BITCOIND_ID sh -c  '/usr/local/bin/bitcoin-cli gettxoutsetinfo'"
        echo "play -cli getmininginfo"
        echo "docker exec -it $BITCOIND_ID sh -c  '/usr/local/bin/bitcoin-cli getmininginfo'"
        echo "play -cli 'getblockhash 1000'"
        echo "docker exec -it $BITCOIND_ID sh -c  '/usr/local/bin/bitcoin-cli $1'"
        echo
        exit

    elif [ -n ${!i} ]; then
        ((i++))
        docker exec -it $BITCOIND_ID sh -c  "$1"
        exit
    fi

done;
play help;
fi #end if docker hash

